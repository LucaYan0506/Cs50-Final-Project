{% extends 'layout.html' %}


{% block menu %}
    <div style="clear:left"></div>
    <p style="color: #858388;font-size:18px">Notes 
        <label id="add-notes" onclick="show_add_note_view()">+</label>
    </p>
    <div id="notes">
        {% for folder in folders  %}
            <button class="folder" onclick="collaps_uncollapse(this,pages{{folder.pk}})">
                {{folder.title}}<span class="arrow {% if folder.pages.exists %}down {% else %}right{% endif %}"></span>
            </button>
            <div id="pages{{folder.pk}}">
                {% for note in folder.pages.all %}
                    <div id="card" name="note_{{note.pk}}" onclick="choose_page(this,{{note.pk}})">{% if note.title %}{{note.title}}{% endif %}</div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>


    <div style="margin-top:15px;border-top: 1px solid #b8bcc0"></div>

    <div id="sub-menu-user">
        <div onclick="show_add_folder_view()">
            New folder...
        </div>
        <div onclick="show_add_note_view()">
            New page...
        </div>
        <div onclick="show_add_note_view()">
            Delete folder...
        </div>
        <a href={% url 'chat' %}><div>Chat</div></a>
        <div style="margin:10px 0px;border-top: 1.5px solid #b8bcc0;width:150px;padding:0px"></div>
        <a href={% url 'logout' %}><div>Sign out</div></a>
    </div>
{% endblock menu %}

{% block body %}
    <nav class="nav-bar" style="font-size:18px;margin-bottom:25px;">
        <div class="nav-link" style="float:left;background-color:#e23d32;color:white;padding:5px;margin-left:50px" onclick="alert('working in progress')">Delete</div>

        <div class="nav-link" style="float:right" onclick="save_btn()">Save</div>
        <div class="nav-link" style="float:right" onclick="show_share_view()">Share</div>
        <div class="nav-link" style="float:right" onclick="print_element('.body')">Print</div>
        <div class="nav-link" style="float:right" onclick="alert('working in progress')">Add</div>

        <div style="clear:both"></div>
    </nav>

    <div id="note" onkeyup="autosave(this)">
        <h1 contentEditable="true" onkeyup="check_empty_title(this)"></h1>
        <div id="content" contentEditable="true" onkeyup="check_empty(this)"></div>
    </div>

    <div id="container" style="position:absolute;left:auto;margin-left:-35px;margin-top:-8px;padding-right:43px;padding-bottom:21px">
        <div id="share">
            <form action="{% url 'create_chat' %}" method="post">
                {% csrf_token %}
                <b>Share</b><br>
                <label style="display:inline-block;margin: 0.5rem;margin-bottom:14px;">Page1</label><br>
                <label class="form-control" id="dropmenu">Share with...</label>
                <div style="display:none;max-width: 165px;border-radius:0.375rem" id ="users-container">
                    <ul style="list-style-type:none; padding-right: 20px;padding-left:0px;margin:0px;">
                        {% for user in all_users %}
                            {% if user != request.user %}
                                <li style="display:block ruby">
                                    <input type="checkbox" name="users" id="user{{user.pk}}" value="{{user.pk}}" />
                                    <label style="margin-right: 15px;" class="form-check-label" for="user{{user.pk}}">{{user}}</label>
                                </li>
                            {% endif %}
                        {% endfor %}
                       
                    </ul>
                </div>
                <button id="blue-btn" style="margin-top:-6px">Share</button>
            </form>
        </div>
    </div>

    <! --- this is script is used to open last page when a new page is created  --->
    {% if go_last_page %}
    <script>
        document.addEventListener('DOMContentLoaded',() => {
            const card = document.getElementsByName("note_{{go_last_page}}")[0];
            choose_page(card,"{{go_last_page}}");
        })
    </script>
    {% else %}
    <script>
        document.addEventListener('DOMContentLoaded',() => {
            document.querySelector('#card').click();
        })
    </script>
    {% endif %}
    {% if error %}
    <script>
        alert('{{error}}')
    </script>    
    {% endif %}
    {% csrf_token %}
{% endblock body %}
